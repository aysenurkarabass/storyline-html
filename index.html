<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tam G√∂lge ‚Äì Noktasal I≈üƒ±k</title>
<style>
* { box-sizing: border-box; }
body { 
  margin:0; 
  background:#accef0; 
  font-family:Arial;
  padding: 8px;
}
.container {
  max-width: 1050px;
  margin: 0 auto;
}
canvas {
  display:block;
  margin:auto;
  background:#f5f3f3;
  border:1px solid #000000;
  touch-action:none;
  width: 100%;
  max-width: 1000px;
  height: auto;
}
.controls{
  width: 100%;
  max-width: 1000px;
  margin:6px auto;
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap: wrap;
  justify-content: center;
}
button{ 
  padding:6px 14px; 
  font-size:clamp(12px, 2vw, 14px);
  cursor: pointer;
  flex-shrink: 0;
}
label{ 
  font-size:clamp(12px, 2vw, 14px);
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}
input[type="range"] {
  width: clamp(100px, 20vw, 150px);
}

@media (max-width: 600px) {
  body { padding: 4px; }
  .controls {
    gap: 6px;
  }
  button {
    padding: 5px 10px;
  }
  input[type="range"] {
    width: 80px;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="controls">
    <button id="penBtn">‚úèÔ∏è Kalem Modu</button>
    <button id="clearBtn">üßπ √áizgileri Temizle</button>
    <label>
      Cisim Boyutu
      <input type="range" id="sizeSlider" min="25" max="70" value="45">
    </label>
  </div>

  <canvas id="canvas" width="1000" height="450"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let penMode=false, drawing=false, dragTarget=null, offsetX=0;
let rays=[];
let scale = 1;
let originalLight, originalObject, originalScreen;

// NESNELER (Orijinal deƒüerler - 1000x450 canvas i√ßin)
const light={x:120,y:225,r:6};
const object={x:400,y:225,r:45};
const screen={x:760,y:40,w:90,h:370};

originalLight = {...light};
originalObject = {...object};
originalScreen = {...screen};

// Canvas'ƒ± responsive yap (16:9 oranƒ±nda)
function resizeCanvas() {
  const container = canvas.parentElement;
  const rect = container.getBoundingClientRect();
  const maxWidth = Math.min(window.innerWidth - 16, 1000);
  
  canvas.style.width = maxWidth + 'px';
  
  const displayWidth = canvas.offsetWidth;
  const displayHeight = displayWidth * (9/16); // 16:9 oranƒ±
  
  canvas.style.height = displayHeight + 'px';
  
  // Canvas resolution'ƒ± ayarla (√ßizim kalitesi i√ßin)
  const rect2 = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect2.width);
  canvas.height = Math.round(rect2.height);
  
  // Yeni canvas oranƒ±na g√∂re scale'i ayarla
  scale = canvas.width / 1000;
  
  // Nesneleri √∂l√ßekle
  light.x = originalLight.x * scale;
  light.y = originalLight.y * scale;
  light.r = originalLight.r * scale;
  
  object.x = originalObject.x * scale;
  object.y = originalObject.y * scale;
  object.r = originalObject.r * scale;
  
  screen.x = originalScreen.x * scale;
  screen.y = originalScreen.y * scale;
  screen.w = originalScreen.w * scale;
  screen.h = originalScreen.h * scale;
  
  drawScene();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// BUTONLAR
penBtn.onclick=()=>{
  penMode=!penMode;
  penBtn.innerText=penMode?"üñ±Ô∏è Ta≈üƒ±ma Modu":"‚úèÔ∏è Kalem Modu";
};
clearBtn.onclick=()=>{rays=[];drawScene();};
sizeSlider.oninput=e=>{object.r=+e.target.value;drawScene();};

// √áƒ∞Zƒ∞M
function drawScene(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // I≈ûIK PARILTI
  const glow=ctx.createRadialGradient(light.x,light.y,1,light.x,light.y,25*scale);
  glow.addColorStop(0,"rgba(255,220,100,0.9)");
  glow.addColorStop(1,"rgba(255,220,100,0)");
  ctx.fillStyle=glow;
  ctx.beginPath();
  ctx.arc(light.x,light.y,25*scale,0,Math.PI*2);
  ctx.fill();

  // I≈ûIK NOKTA
  ctx.fillStyle="#ffd000";
  ctx.beginPath();
  ctx.arc(light.x,light.y,light.r,0,Math.PI*2);
  ctx.fill();

  // Cƒ∞Sƒ∞M
  const grad=ctx.createRadialGradient(
    object.x-object.r/3,object.y-object.r/3,5*scale,
    object.x,object.y,object.r
  );
  grad.addColorStop(0,"#ddd");
  grad.addColorStop(1,"#555");
  ctx.fillStyle=grad;
  ctx.beginPath();
  ctx.arc(object.x,object.y,object.r,0,Math.PI*2);
  ctx.fill();

  // PERDE (GENƒ∞≈û & UZUN)
  const pgrad=ctx.createLinearGradient(screen.x+screen.w,0,screen.x,0);
  pgrad.addColorStop(0,"#cfe8f3");
  pgrad.addColorStop(1,"#7fb6d9");
  ctx.fillStyle=pgrad;
  ctx.beginPath();
  ctx.moveTo(screen.x+screen.w,screen.y);
  ctx.lineTo(screen.x,screen.y+25*scale);
  ctx.lineTo(screen.x,screen.y+screen.h-25*scale);
  ctx.lineTo(screen.x+screen.w,screen.y+screen.h);
  ctx.closePath();
  ctx.fill();

  // I≈ûINLAR
  ctx.strokeStyle="#000";
  ctx.lineWidth=2*scale;
  rays.forEach(r=>{
    ctx.beginPath();
    ctx.moveTo(r.start.x,r.start.y);
    ctx.lineTo(r.end.x,r.end.y);
    ctx.stroke();
  });

  if(rays.length===2) drawShadow();

  // ETƒ∞KETLER
  ctx.fillStyle="#000";
  ctx.font=`${14*scale}px Arial`;
  ctx.fillText("I≈üƒ±k",light.x-12*scale,light.y+22*scale);
  ctx.fillText("Cisim",object.x-18*scale,object.y+object.r+18*scale);
  ctx.fillText("Perde",screen.x+10*scale,screen.y+screen.h+20*scale);
}

// G√ñLGE ‚Äì TAM OTURAN ELƒ∞PS
function drawShadow(){
  const ys=rays.map(r=>{
    const t=(screen.x-r.start.x)/(r.end.x-r.start.x);
    return r.start.y+t*(r.end.y-r.start.y);
  });

  let top=Math.min(...ys);
  let bottom=Math.max(...ys);

  // PERDE ƒ∞√áƒ∞NE SIƒûDIR
  top=Math.max(top,screen.y);
  bottom=Math.min(bottom,screen.y+screen.h);

  const h=bottom-top;
  if(h<=0)return;

  ctx.fillStyle="rgba(0,0,0,0.35)";
  ctx.beginPath();
  ctx.ellipse(
    screen.x+screen.w/2,
    top+h/2,
    screen.w/2-8*scale,
    h/2,
    0,0,Math.PI*2
  );
  ctx.fill();
}

// MOUSE
canvas.onmousedown=e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left, y=e.clientY-r.top;

  if(penMode && Math.hypot(x-light.x,y-light.y)<10 && rays.length<2){
    drawing=true;
    rays.push({start:{x:light.x,y:light.y},end:{x,y}});
    return;
  }

  if(!penMode){
    if(Math.hypot(x-light.x,y-light.y)<10){dragTarget=light;offsetX=x-light.x;}
    else if(Math.hypot(x-object.x,y-object.y)<object.r){dragTarget=object;offsetX=x-object.x;}
    else if(x>screen.x && x<screen.x+screen.w){dragTarget=screen;offsetX=x-screen.x;}
  }
};

canvas.onmousemove=e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left, y=e.clientY-r.top;

  if(drawing){
    rays[rays.length-1].end={x,y};
    drawScene();
  }
  else if(dragTarget){
    dragTarget.x=x-offsetX;
    drawScene();
  }
};

canvas.onmouseup=()=>{drawing=false;dragTarget=null;};

drawScene();
</script>
</body>
</html>
